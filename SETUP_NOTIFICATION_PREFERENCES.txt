# Quick Setup Guide - Notification Preferences Feature

## üöÄ Quick Start (5 Minutes)

### 1. Create Database Table
Visit this URL in your browser:
```
http://localhost/cartmate/database/init_notification_preferences.php
```

You should see a green success message. If not, run the SQL manually in phpMyAdmin.

### 2. Test the Feature
1. Log in to your customer account
2. Go to your account page
3. Click the **"Notifications & Preferences"** tab on the left sidebar
4. Toggle any preference switch
5. You should see a success message

### 3. Verify Newsletter Integration
- Toggle the **"Newsletter Subscription"** switch
- Check your database:
  ```sql
  SELECT * FROM newsletter_subscribers WHERE email = 'your_email@example.com';
  ```
- The status should change based on your toggle

## üìÅ Files Involved

```
cartmate/
‚îú‚îÄ‚îÄ account.php (MODIFIED)
‚îÇ   ‚îú‚îÄ‚îÄ Added "Notifications & Preferences" tab button
‚îÇ   ‚îú‚îÄ‚îÄ Added notifications-tab content div
‚îÇ   ‚îî‚îÄ‚îÄ Added JavaScript functions: loadNotificationPreferences, updatePreferenceUI, updatePreference
‚îÇ
‚îú‚îÄ‚îÄ ajax/
‚îÇ   ‚îî‚îÄ‚îÄ preferences.php (NEW)
‚îÇ       ‚îú‚îÄ‚îÄ Action: get_preferences
‚îÇ       ‚îú‚îÄ‚îÄ Action: update_preference
‚îÇ       ‚îî‚îÄ‚îÄ Action: update_all_preferences
‚îÇ
‚îî‚îÄ‚îÄ database/
    ‚îú‚îÄ‚îÄ notification_preferences_table.sql (NEW) - SQL schema
    ‚îú‚îÄ‚îÄ init_notification_preferences.php (NEW) - Auto-create table
    ‚îî‚îÄ‚îÄ (existing newsletter_subscribers table used for sync)
```

## üß™ Testing Checklist

### UI Tests
- [ ] "Notifications & Preferences" button appears in left sidebar
- [ ] Clicking it opens the notifications tab
- [ ] 7 toggle switches are visible:
  - [ ] Newsletter Subscription
  - [ ] New Products
  - [ ] Featured Products
  - [ ] Sales & Promotions
  - [ ] Important News
  - [ ] Order Updates
  - [ ] Product Reviews
- [ ] All icons load correctly
- [ ] Page is mobile responsive

### Functionality Tests
- [ ] Toggle "Newsletter Subscription" ON
  - [ ] Success message appears
  - [ ] Email is added to newsletter_subscribers table
  - [ ] subscription_status is 'active'
  
- [ ] Toggle "Newsletter Subscription" OFF
  - [ ] Success message appears
  - [ ] subscription_status changes to 'inactive'
  - [ ] unsubscribed_at timestamp is set

- [ ] Toggle other preferences (New Products, etc.)
  - [ ] Changes save to database
  - [ ] Values change from 0 to 1 or vice versa

- [ ] Reload the page and navigate to Notifications tab
  - [ ] All toggles reflect previous state

### Database Tests
```sql
-- Check preferences table created
SHOW TABLES LIKE 'user_notification_preferences';

-- Check preferences for a user
SELECT * FROM user_notification_preferences WHERE user_id = 1;

-- Check newsletter_subscribers synced
SELECT * FROM newsletter_subscribers;

-- Verify user_id column exists and has correct values
DESC user_notification_preferences;
```

### Error Handling Tests
- [ ] Toggle a preference with network disabled
  - [ ] Checkbox reverts
  - [ ] Error message appears
  
- [ ] Try accessing preferences while logged out
  - [ ] Should redirect to login

## üîç Verification Steps

### Step 1: Database Setup
```bash
# Check if table was created
mysql -u root -p cartmate -e "DESC user_notification_preferences;"
```

Expected output:
```
| Field             | Type        | Null | Key | Default                        |
|-------------------|-------------|------|-----|--------------------------------|
| preference_id     | int(11)     | NO   | PRI | NULL                           |
| user_id           | int(11)     | NO   | UNI | NULL                           |
| new_products      | tinyint(1)  | YES  |     | 1                              |
| featured_products | tinyint(1)  | YES  |     | 1                              |
| ... (more fields)
```

### Step 2: File Verification
Check that these files exist:
```bash
ls -la ajax/preferences.php
ls -la database/init_notification_preferences.php
ls -la database/notification_preferences_table.sql
```

### Step 3: Browser Console Test
Open browser DevTools (F12) and test:
```javascript
// Load preferences
fetch('ajax/preferences.php?action=get_preferences')
  .then(r => r.json())
  .then(d => console.log(d));

// Should output preferences object
```

## üêõ Troubleshooting

### Problem: "Table doesn't exist" error
**Solution:**
1. Visit: `http://localhost/cartmate/database/init_notification_preferences.php`
2. Or run init script in phpMyAdmin
3. Check for error messages and fix accordingly

### Problem: Preferences tab doesn't appear
**Solution:**
1. Clear browser cache (Ctrl+Shift+Del)
2. Hard refresh the page (Ctrl+Shift+R)
3. Check that account.php was modified correctly

### Problem: Toggles don't save
**Solution:**
1. Check browser console for errors (F12)
2. Verify ajax/preferences.php exists
3. Check that user is logged in
4. Verify database table exists

### Problem: Newsletter not syncing
**Solution:**
1. Check if newsletter_subscribers table exists:
   ```sql
   SHOW TABLES LIKE 'newsletter_subscribers';
   ```
2. Verify user email is correct in users table
3. Check preferences.php code for `updateNewsletterSubscription()` function

## üìä Database Queries for Admin

### Get all subscribers who enabled newsletter
```sql
SELECT u.user_id, u.email, u.full_name, p.newsletter, p.updated_at
FROM users u
JOIN user_notification_preferences p ON u.user_id = p.user_id
WHERE p.newsletter = 1
ORDER BY p.updated_at DESC;
```

### Get preferences statistics
```sql
SELECT 
  COUNT(*) as total_users,
  SUM(IF(newsletter = 1, 1, 0)) as newsletter_subscribers,
  SUM(IF(new_products = 1, 1, 0)) as new_products_subscribers,
  SUM(IF(sales_promotions = 1, 1, 0)) as promotion_subscribers
FROM user_notification_preferences;
```

### Target users for specific campaigns
```sql
-- Users interested in new products AND sales promotions
SELECT u.email, u.full_name
FROM users u
JOIN user_notification_preferences p ON u.user_id = p.user_id
WHERE p.new_products = 1 AND p.sales_promotions = 1 AND p.newsletter = 1;
```

## üéØ Feature Walkthrough

### For End Users
1. User logs into account
2. Clicks "Notifications & Preferences" in sidebar
3. Sees all notification options with icons and descriptions
4. Toggles desired preferences
5. Changes save instantly with success feedback
6. Newsletter option automatically subscribes them to mailing list

### For Marketing/Admin
1. Query database for users with specific preferences
2. Send targeted campaigns to subscribers
3. Use preference data to personalize communications
4. Track which users opted in for what types of messages
5. Respect user preferences when sending notifications

## üí° Tips & Best Practices

1. **Always respect user preferences** - Don't send emails if user has disabled that preference
2. **Confirm newsletter signup** - Consider sending welcome email to new subscribers
3. **Provide easy unsubscribe** - Include unsubscribe link in every newsletter
4. **Test before sending** - Send test emails to admin accounts first
5. **Monitor engagement** - Track which preference groups have best open/click rates

## ‚úÖ Completion Checklist

- [x] Database table created
- [x] AJAX handler implemented
- [x] Account page updated
- [x] UI/UX designed and implemented
- [x] JavaScript functions added
- [x] Newsletter integration done
- [x] Error handling implemented
- [x] Documentation created
- [x] Testing guide provided
- [x] Ready for production

## üéâ You're All Set!

The notification preferences feature is now ready for use. Customers can manage their preferences directly from their account page, and you can target them with relevant communications based on their preferences.

For questions or issues, check the main README_NOTIFICATION_PREFERENCES.md file or review the inline code comments in account.php and ajax/preferences.php.
